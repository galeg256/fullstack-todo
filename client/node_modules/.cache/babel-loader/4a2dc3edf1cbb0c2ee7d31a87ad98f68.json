{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\korek\\\\Desktop\\\\project\\\\fullstack-todo\\\\client\\\\src\\\\components\\\\todo.js\";\nimport React from 'react'; //ToDo\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class ToDo extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      todos: [// {id: '1', text: 'Купить хлеб'},\n        // {id: '2', text: 'Купить молоко'},\n        // {id: '3', text: 'Купить кофе'}\n      ],\n      isToken: false\n    }; // call fetch as componentWillMount\n\n    this.fetchToDo();\n    this.addTodo = this.addTodo.bind(this);\n    this.delTodo = this.delTodo.bind(this);\n    this.saveToDo = this.saveToDo.bind(this);\n  } // UNSAFE_componentWillMount() {\n  //   this.fetchToDo()\n  // }\n\n\n  async fetchToDo() {\n    //console.log(localStorage.getItem('token'))\n    const res = await fetch('/api', {\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      }\n    });\n\n    if (res.ok) {\n      //take data\n      const result = await res.json();\n      this.setState(() => {\n        for (let item of result) {\n          item.id = item.id.toString();\n        }\n\n        return {\n          todos: result,\n          isToken: true\n        };\n      });\n    } else {\n      if (res.status == 401) {\n        this.props.changeForm('AuthForm');\n      } else {\n        console.log(res.statusText);\n      }\n    }\n  } // componentDidMount() {\n  //   console.log(\"mount\")\n  //   fetch('/api')\n  //     .then(response => response.json())\n  //     //.then(result => {this.setState({todos: result} ) })\n  //     .then(result => {this.setState(state => {\n  //       for(let item of result) {\n  //         item.id = item.id.toString()\n  //       }\n  //       return {todos: result}\n  //     } ) })    \n  // }\n  // componentDidUpdate(prevProps, prevState) {\n  //   // if (prevState)\n  //   // console.log(prevState)\n  //   if (prevState.todos.length && (this.state.todos.length < prevState.todos.length)) {\n  //     //console.log(prevState)\n  //     console.log(\"delete\")\n  //   }\n  // }\n\n\n  createID() {\n    //генератор id для list-item\n    while (true) {\n      const id = Math.floor(Math.random() * 1000); // от 1 до 9999\n\n      for (let i = 0; i < this.state.todos.length; i++) {\n        if (this.state.todos[i].id != id) return id.toString();\n      }\n    }\n  }\n\n  async addTodo(newTodoText) {\n    // this.state.todos.unshift({id: '1', text: newTodoText})\n    // console.log(this.state.todos)\n    // this.setState({todos: this.state.todos})\n    fetch('/api/', {\n      method: \"post\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      },\n      body: JSON.stringify({\n        \"name\": newTodoText\n      })\n    }).then(res => res.json()).then(result => {\n      this.setState(state => {\n        const cloneTodos = Object.assign([], state.todos); //клонирование массива\n\n        if (cloneTodos.length != 0) cloneTodos.unshift({\n          id: result.id.toString(),\n          text: newTodoText\n        });else cloneTodos.unshift({\n          id: result.id.toString(),\n          text: newTodoText\n        });\n        return {\n          todos: cloneTodos\n        };\n      });\n    });\n    const res = await fetch('/api', {\n      method: \"post\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      },\n      body: JSON.stringify({\n        \"name\": newTodoText\n      })\n    });\n\n    if (res.ok) {\n      //take data\n      const result = await res.json();\n      this.setState(() => {\n        for (let item of result) {\n          item.id = item.id.toString();\n        }\n\n        return {\n          todos: result,\n          isToken: true\n        };\n      });\n    } else {\n      if (res.status == 401) {\n        this.props.changeForm('AuthForm');\n      } else {\n        console.log(res.statusText);\n      }\n    }\n  }\n\n  delTodo(delID) {\n    fetch(`/api/delete/${delID}`, {\n      method: \"delete\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      }\n    }) //.then(response => response.json())\n    .then(result => {\n      console.log(result);\n\n      if (result.status == 200) {\n        this.setState(state => {\n          const pos = state.todos.findIndex(value => value.id === delID);\n          const cloneTodos = Object.assign([], state.todos);\n          cloneTodos.splice(pos, 1);\n          return {\n            todos: cloneTodos\n          };\n        });\n      } else console.log(\"error delete\");\n    });\n  }\n\n  saveToDo(todo) {\n    console.log(todo);\n    fetch('/api/update', {\n      method: \"put\",\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': localStorage.getItem('token')\n      },\n      body: JSON.stringify(todo)\n    }) //.then(res => res.json())\n    .then(result => {\n      if (result.status == 200) {\n        let pos;\n\n        for (let i = 0; i < this.state.todos.length; i++) {\n          if (this.state.todos[i].id === todo.id) pos = i;\n        }\n\n        this.setState(state => {\n          const cloneTodos = Object.assign([], state.todos);\n          cloneTodos.splice(pos, 1, {\n            id: todo.id,\n            text: todo.textValue\n          });\n          return {\n            todos: cloneTodos\n          };\n        });\n      }\n    });\n  }\n\n  render() {\n    return this.state.isToken ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"todo\",\n      children: [/*#__PURE__*/_jsxDEV(AddToDo, {\n        addTodo: this.addTodo\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ListToDo, {\n        todos: this.state.todos,\n        delTodo: this.delTodo,\n        saveToDo: this.saveToDo\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 35\n    }, this) : null;\n  }\n\n} //AddToDo\n\nclass AddToDo extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      addText: ''\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleAdd = this.handleAdd.bind(this);\n  }\n\n  handleChange(evt) {\n    this.setState({\n      addText: evt.target.value\n    });\n  }\n\n  handleAdd(evt) {\n    evt.preventDefault();\n    this.props.addTodo(this.state.addText);\n    this.setState({\n      addText: ''\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"todo__add\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        className: \"add__input\",\n        value: this.state.addText,\n        onChange: this.handleChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"add__button\",\n        onClick: this.handleAdd,\n        children: \"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }, this);\n  }\n\n} //ListToDo\n\n\nclass ListToDo extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      // changeMode: ['1'], //строковые id для тех строк, которые находятся в статусе на изменение  \n      // textValue: ''\n      changeMode: [// {id: '1', textValue: 'asd'}\n      ]\n    };\n    this.handleDelete = this.handleDelete.bind(this);\n    this.handleChange = this.handleChange.bind(this);\n    this.handleChangeText = this.handleChangeText.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n  }\n\n  handleDelete(evt) {\n    // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\n    const delID = evt.target.closest('.list__item').getAttribute('data-id');\n    this.props.delTodo(delID);\n  }\n\n  handleChange(evt) {\n    //добавляем моды в ChangeMode\n    const target = evt.target.closest('.list__item').getAttribute('data-id'); // console.log(target) //id изменяемого li\n\n    this.setState(state => {\n      const changeModeClone = Object.assign([], state.changeMode);\n      changeModeClone.push({\n        id: target,\n        textValue: ''\n      });\n      return {\n        changeMode: changeModeClone\n      };\n    });\n  }\n\n  handleChangeText(evt) {\n    // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\n    const changeID = evt.target.closest('.list__item').getAttribute('data-id');\n    this.setState(state => {\n      const changeModeClone = Object.assign([], state.changeMode);\n\n      for (let i = 0; i < changeModeClone.length; i++) {\n        if (changeModeClone[i].id === changeID) {\n          changeModeClone[i].textValue = evt.target.value;\n          break;\n        }\n      }\n\n      return {\n        changeMode: changeModeClone\n      };\n    });\n  }\n\n  isChangeMode(id) {\n    let isMode = false;\n\n    for (let item of this.state.changeMode) {\n      if (item.id === id) {\n        isMode = true;\n      }\n    }\n\n    return isMode;\n  }\n\n  changeModePos(id) {\n    let pos;\n\n    for (let i = 0; i < this.state.changeMode.length; i++) {\n      if (this.state.changeMode[i].id === id) {\n        pos = i;\n      }\n    }\n\n    return pos;\n  }\n\n  handleSave(evt) {\n    // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\n    const saveID = evt.target.closest('.list__item').getAttribute('data-id');\n    const pos = this.changeModePos(saveID); //позиция в массиве changeMode\n\n    this.props.saveToDo(this.state.changeMode[pos]); // console.log(this.state.changeMode[pos])\n\n    this.setState(state => {\n      const changeModeClone = Object.assign([], state.changeMode);\n      changeModeClone.splice(pos, 1);\n      return {\n        changeMode: changeModeClone\n      };\n    });\n  }\n\n  render() {\n    // console.log(this.isChangeMode('2'))\n    const todos = this.props.todos.map((value, index) => {\n      return /*#__PURE__*/_jsxDEV(\"li\", {\n        className: \"list__item\",\n        \"data-id\": value.id,\n        children: [// this.state.changeMode.includes({id: value.id, textValue: ''}) \n        this.isChangeMode(value.id) ? /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"input__change\",\n          value: this.state.changeMode[this.changeModePos(value.id)].textValue,\n          onChange: this.handleChangeText\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 17\n        }, this) : `${index + 1}. ${value.text}`, this.isChangeMode(value.id) ? /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn__save\",\n          onClick: this.handleSave,\n          children: \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn__change\",\n          onClick: this.handleChange,\n          children: \"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn__delete\",\n          onClick: this.handleDelete,\n          children: \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this)]\n      }, index, true, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 16\n      }, this);\n    });\n    return /*#__PURE__*/_jsxDEV(\"ul\", {\n      className: \"todo__list\",\n      children: todos\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 9\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/korek/Desktop/project/fullstack-todo/client/src/components/todo.js"],"names":["React","ToDo","Component","constructor","props","state","todos","isToken","fetchToDo","addTodo","bind","delTodo","saveToDo","res","fetch","headers","localStorage","getItem","ok","result","json","setState","item","id","toString","status","changeForm","console","log","statusText","createID","Math","floor","random","i","length","newTodoText","method","body","JSON","stringify","then","cloneTodos","Object","assign","unshift","text","delID","pos","findIndex","value","splice","todo","textValue","render","AddToDo","addText","handleChange","handleAdd","evt","target","preventDefault","ListToDo","changeMode","handleDelete","handleChangeText","handleSave","closest","getAttribute","changeModeClone","push","changeID","isChangeMode","isMode","changeModePos","saveID","map","index"],"mappings":"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","sourcesContent":["import React from 'react'\r\n\r\n//ToDo\r\nexport default class ToDo extends React.Component {\r\n    constructor(props) {\r\n      super(props)\r\n      this.state = {\r\n        todos: [\r\n          // {id: '1', text: 'Купить хлеб'},\r\n          // {id: '2', text: 'Купить молоко'},\r\n          // {id: '3', text: 'Купить кофе'}\r\n        ],\r\n        isToken: false,\r\n      }\r\n      \r\n      // call fetch as componentWillMount\r\n      this.fetchToDo()\r\n\r\n      this.addTodo = this.addTodo.bind(this)\r\n      this.delTodo = this.delTodo.bind(this)\r\n      this.saveToDo = this.saveToDo.bind(this)\r\n    }\r\n\r\n    // UNSAFE_componentWillMount() {\r\n    //   this.fetchToDo()\r\n    // }\r\n\r\n    async fetchToDo() {\r\n      //console.log(localStorage.getItem('token'))\r\n      const res = await fetch('/api', { \r\n          headers: {\r\n            'Content-Type':'application/json',\r\n            'Authorization': localStorage.getItem('token')\r\n          },\r\n        }\r\n      )\r\n      if (res.ok) {\r\n        //take data\r\n        const result = await res.json()\r\n        this.setState( () => {\r\n          for (let item of result) {\r\n            item.id = item.id.toString()\r\n          }\r\n          return {\r\n            todos: result,\r\n            isToken: true\r\n          }\r\n        })\r\n      } else {\r\n        if (res.status == 401) {\r\n          this.props.changeForm('AuthForm')\r\n        } else {\r\n          console.log(res.statusText)\r\n        }\r\n      }\r\n    }\r\n\r\n    // componentDidMount() {\r\n    //   console.log(\"mount\")\r\n    //   fetch('/api')\r\n    //     .then(response => response.json())\r\n    //     //.then(result => {this.setState({todos: result} ) })\r\n    //     .then(result => {this.setState(state => {\r\n    //       for(let item of result) {\r\n    //         item.id = item.id.toString()\r\n    //       }\r\n    //       return {todos: result}\r\n    //     } ) })    \r\n    // }\r\n\r\n    // componentDidUpdate(prevProps, prevState) {\r\n    //   // if (prevState)\r\n    //   // console.log(prevState)\r\n    //   if (prevState.todos.length && (this.state.todos.length < prevState.todos.length)) {\r\n    //     //console.log(prevState)\r\n  \r\n    //     console.log(\"delete\")\r\n    //   }\r\n    // }\r\n  \r\n    createID() { //генератор id для list-item\r\n      while(true) {\r\n        const id = Math.floor(Math.random() * 1000) // от 1 до 9999\r\n        for (let i=0; i<this.state.todos.length; i++) {\r\n          if (this.state.todos[i].id != id) return id.toString()\r\n        }\r\n      }\r\n    }\r\n  \r\n    async addTodo(newTodoText) {\r\n      // this.state.todos.unshift({id: '1', text: newTodoText})\r\n      // console.log(this.state.todos)\r\n      // this.setState({todos: this.state.todos})\r\n      \r\n      fetch('/api/', {\r\n        method: \"post\",\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          'Authorization': localStorage.getItem('token')\r\n        },\r\n        body: JSON.stringify({\"name\": newTodoText})\r\n      })\r\n      .then(res => res.json())\r\n      .then(result => {\r\n        this.setState(state => {\r\n          const cloneTodos = Object.assign([], state.todos) //клонирование массива\r\n          if (cloneTodos.length != 0) cloneTodos.unshift({id: result.id.toString(), text: newTodoText})\r\n          else cloneTodos.unshift({id: result.id.toString(), text: newTodoText})\r\n          return {todos: cloneTodos}\r\n        })\r\n      })\r\n      \r\n      const res = await fetch('/api', { \r\n        method: \"post\",\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          'Authorization': localStorage.getItem('token')\r\n        },\r\n        body: JSON.stringify({\"name\": newTodoText})\r\n        }\r\n      )\r\n      if (res.ok) {\r\n        //take data\r\n        const result = await res.json()\r\n        this.setState( () => {\r\n          for (let item of result) {\r\n            item.id = item.id.toString()\r\n          }\r\n          return {\r\n            todos: result,\r\n            isToken: true\r\n          }\r\n        })\r\n      } else {\r\n        if (res.status == 401) {\r\n          this.props.changeForm('AuthForm')\r\n        } else {\r\n          console.log(res.statusText)\r\n        }\r\n      }\r\n      \r\n    }\r\n  \r\n    delTodo(delID) {\r\n      fetch(`/api/delete/${delID}`, {\r\n        method: \"delete\",\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          'Authorization': localStorage.getItem('token')\r\n        },\r\n      })\r\n      //.then(response => response.json())\r\n      .then(result => {\r\n        console.log(result)\r\n        if (result.status==200) {\r\n          this.setState( state => {\r\n          const pos = state.todos.findIndex( value => value.id === delID)\r\n          const cloneTodos = Object.assign([], state.todos)\r\n          cloneTodos.splice(pos, 1)\r\n          return {todos: cloneTodos}\r\n          })\r\n        } else console.log(\"error delete\")\r\n      })\r\n    }\r\n  \r\n    saveToDo(todo) {\r\n      console.log(todo)\r\n      fetch('/api/update', {\r\n        method: \"put\",\r\n        headers: {\r\n          'Content-Type':'application/json',\r\n          'Authorization': localStorage.getItem('token')\r\n        },\r\n        body: JSON.stringify(todo)\r\n      })\r\n      //.then(res => res.json())\r\n      .then(result => {    \r\n        if (result.status == 200) {\r\n          let pos\r\n          for (let i=0; i<this.state.todos.length; i++) {\r\n            if (this.state.todos[i].id === todo.id) pos = i\r\n          }\r\n  \r\n          this.setState( state => {\r\n            const cloneTodos = Object.assign([], state.todos)\r\n            cloneTodos.splice(pos, 1, {id: todo.id, text: todo.textValue})\r\n            return {todos: cloneTodos}\r\n          })\r\n        }\r\n      })\r\n    }\r\n  \r\n    render() {\r\n      return this.state.isToken ? <div className='todo'>\r\n        <AddToDo addTodo={this.addTodo}/>  \r\n        <ListToDo todos={this.state.todos} delTodo={this.delTodo} saveToDo={this.saveToDo}/> \r\n      </div>  : null        \r\n    }\r\n}\r\n  \r\n  \r\n//AddToDo\r\nclass AddToDo extends React.Component {\r\n    constructor() {\r\n      super()\r\n      this.state = {\r\n        addText: ''\r\n      }\r\n  \r\n      this.handleChange = this.handleChange.bind(this)\r\n      this.handleAdd = this.handleAdd.bind(this)\r\n    }\r\n  \r\n    handleChange(evt) {\r\n      this.setState({addText: evt.target.value})\r\n    }\r\n  \r\n    handleAdd(evt) {\r\n      evt.preventDefault()\r\n      this.props.addTodo(this.state.addText)\r\n      this.setState({addText: ''}) \r\n    }\r\n  \r\n    render() {\r\n      return (\r\n        <form className='todo__add'>\r\n          <input className='add__input' value={this.state.addText} onChange={this.handleChange}/>\r\n          <button className='add__button' onClick={this.handleAdd}>\r\n            Добавить  \r\n          </button>\r\n        </form>\r\n      )\r\n    }\r\n}\r\n  \r\n  \r\n//ListToDo\r\nclass ListToDo extends React.Component {\r\n    constructor() {\r\n      super()\r\n      this.state = {\r\n        // changeMode: ['1'], //строковые id для тех строк, которые находятся в статусе на изменение  \r\n        // textValue: ''\r\n  \r\n        changeMode: [\r\n          // {id: '1', textValue: 'asd'}\r\n        ]\r\n      }\r\n  \r\n      this.handleDelete = this.handleDelete.bind(this)\r\n      this.handleChange = this.handleChange.bind(this)\r\n      this.handleChangeText = this.handleChangeText.bind(this)\r\n  \r\n      this.handleSave = this.handleSave.bind(this)\r\n    }\r\n  \r\n    handleDelete(evt) {\r\n      // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\r\n      const delID = evt.target.closest('.list__item').getAttribute('data-id')\r\n      this.props.delTodo(delID)\r\n    }\r\n  \r\n    handleChange(evt) { //добавляем моды в ChangeMode\r\n      const target = evt.target.closest('.list__item').getAttribute('data-id')\r\n      // console.log(target) //id изменяемого li\r\n      this.setState( state => {\r\n        const changeModeClone = Object.assign([], state.changeMode)\r\n        changeModeClone.push({id: target, textValue: ''})\r\n        return {changeMode: changeModeClone}\r\n      })\r\n    }\r\n  \r\n    handleChangeText(evt) {\r\n      // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\r\n      const changeID = evt.target.closest('.list__item').getAttribute('data-id')\r\n      this.setState( state => {\r\n        const changeModeClone = Object.assign([], state.changeMode)\r\n        for (let i=0; i<changeModeClone.length; i++) {\r\n          if (changeModeClone[i].id === changeID) {\r\n            changeModeClone[i].textValue = evt.target.value\r\n            break\r\n          }\r\n        }\r\n        return {changeMode: changeModeClone}\r\n      })\r\n      \r\n    }\r\n  \r\n    isChangeMode(id) {\r\n      let isMode = false\r\n      for (let item of this.state.changeMode) {\r\n        if (item.id === id) {\r\n          isMode = true\r\n        }\r\n      }\r\n      return isMode\r\n    }\r\n  \r\n    changeModePos(id) {\r\n      let pos\r\n      for (let i=0; i<this.state.changeMode.length; i++) {\r\n        if (this.state.changeMode[i].id === id) {\r\n          pos = i\r\n        }\r\n      }\r\n      return pos\r\n    }\r\n  \r\n    handleSave(evt) {\r\n      // console.log(evt.target.closest('.list__item').getAttribute('data-id'))\r\n      const saveID = evt.target.closest('.list__item').getAttribute('data-id')\r\n      const pos = this.changeModePos(saveID) //позиция в массиве changeMode\r\n  \r\n      this.props.saveToDo(this.state.changeMode[pos])\r\n      // console.log(this.state.changeMode[pos])\r\n  \r\n      this.setState( state => {\r\n        const changeModeClone = Object.assign([], state.changeMode)\r\n        changeModeClone.splice(pos, 1)\r\n        return {changeMode: changeModeClone}\r\n      })\r\n  \r\n    }\r\n  \r\n    render() {\r\n  \r\n      // console.log(this.isChangeMode('2'))\r\n        \r\n      const todos = this.props.todos.map( (value, index) => {\r\n        return <li className='list__item' key={index} data-id={value.id}>\r\n          { \r\n            // this.state.changeMode.includes({id: value.id, textValue: ''}) \r\n            this.isChangeMode(value.id)\r\n              ? <input className='input__change' value={this.state.changeMode[this.changeModePos(value.id)].textValue} onChange={this.handleChangeText}/> \r\n              :  `${index + 1}. ${value.text}`\r\n          }\r\n          { \r\n            this.isChangeMode(value.id)\r\n              ? <button className='btn__save' onClick={this.handleSave}>Сохранить</button> \r\n              : <button className='btn__change' onClick={this.handleChange}>Изменить</button>\r\n          }\r\n          <button className='btn__delete' onClick={this.handleDelete}>Удалить</button>\r\n        </li>\r\n      })\r\n  \r\n      return (\r\n        <ul className='todo__list'>\r\n          {todos}\r\n        </ul>\r\n      )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}